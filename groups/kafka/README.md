# kafka-stack

## Overview

Creates an Apache [Kafka](https://kafka.apache.org/) broker cluster including a supporting Apache [Zookeeper](https://zookeeper.apache.org/) cluster

## Requirements

| Name      | Version         |
| --------- | --------------- |
| terraform | >= 0.13, < 0.14 |

## Providers

| Name | Version       |
| ---- | ------------- |
| aws  | >= 3.0, < 4.0 |

## Inputs

| Name                            | Description                                                                                                                                                                                                                                                                                                                                                       | Type                 | Default       | Required |
| ------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- | ------------- | -------- |
| account_name                    | The name of the AWS account we're using                                                                                                                                                                                                                                                                                                                           | `string`             | `-`           | yes      |
| environment                     | The environment name to be used when creating AWS resources                                                                                                                                                                                                                                                                                                       | `string`             | `-`           | yes      |
| kafka_ami_version_pattern       | The pattern with which to match kafka AMIs                                                                                                                                                                                                                                                                                                                        | `string`             | `\\d.\\d.\\d` | no       |
| kafka_instance_count            | The number of kafka instances to provision                                                                                                                                                                                                                                                                                                                        | `number`             | `1`           | no       |
| kafka_instance_type             | The kafka instance type to use                                                                                                                                                                                                                                                                                                                                    | `string`             | `t3.medium`   | no       |
| kafka_lvm_block_definitions     | Kafka LVM block definitions                                                                                                                                                                                                                                                                                                                                       | `list(object({...})` | `[{...}]`     | no       |
| kafka_root_volume_size_gib      | The size of the kafka root volume in GiB; set this value to 0 to preserve the size specified in the AMI metadata. This value should not be smaller than the size specified in the AMI metadata and used by the root volume snapshot. The filesystem will be expanded automatically to use all available space for the volume and an XFS filesystem is assumed     | `number`             | `20`          | no       |
| region                          | The AWS region in which resources will be created                                                                                                                                                                                                                                                                                                                 | `string`             | `-`           | yes      |
| repository_name                 | The name of the repository in which we're operating                                                                                                                                                                                                                                                                                                               | `string`             | `kafka-stack` | no       |
| route53_available               | A flag indicating whether Route53 is available                                                                                                                                                                                                                                                                                                                    | `bool`               | `-`           | yes      |
| service                         | The service name to be used when creating AWS resources                                                                                                                                                                                                                                                                                                           | `string`             | `kafka3`      | no       |
| ssh_keyname                     | The SSH keypair name to use for remote connectivity                                                                                                                                                                                                                                                                                                               | `string`             | `-`           | yes      |
| team                            | The team responsible for administering the instance                                                                                                                                                                                                                                                                                                               | `string`             | `platform`    | yes      |
| zookeeper_ami_version_pattern   | The pattern with which to match zookeeper AMIs                                                                                                                                                                                                                                                                                                                    | `string`             | `\\d.\\d.\\d` | no       |
| zookeeper_instance_count        | The number of zookeeper instances to provision                                                                                                                                                                                                                                                                                                                    | `number`             | `1`           | no       |
| zookeeper_instance_type         | The zookeeper instance type to use                                                                                                                                                                                                                                                                                                                                | `string`             | `t3.medium`   | no       |
| zookeeper_lvm_block_definitions | Zookeeper LVM block definitions                                                                                                                                                                                                                                                                                                                                   | `list(object({...})` | `[{...}]`     | no       |
| zookeeper_root_volume_size_gib  | The size of the zookeeper root volume in GiB; set this value to 0 to preserve the size specified in the AMI metadata. This value should not be smaller than the size specified in the AMI metadata and used by the root volume snapshot. The filesystem will be expanded automatically to use all available space for the volume and an XFS filesystem is assumed | `number`             | `20`          | no       |

## Outputs

| Name         | Description                                                                                                                 |
| ------------ | --------------------------------------------------------------------------------------------------------------------------- |
| manual_steps | Any manual steps that may be required when automation isn't possible. For example DNS entries where Route53 isn't available |
